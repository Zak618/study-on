{% extends 'base.html.twig' %}

{% block title %}Курсы
{% endblock %}

{% block body %}
	<div class="container1">
		<div class="logo">
			<span class="logo-text">StudyOn</span>
			<span class="tagline">Образование твоей мечты</span>
			<span class="credit">Design by Rolan</span>
		</div>
	</div>
	<div class="container">
		<h1>Курсы</h1>

		<div class="row">
			{% for course in courses %}
				<div class="col-md-6 col-lg-4">
					<div class="card mb-4">
						<div class="card-body">
							<h5>
								<a href="{{ path('app_course_show', {'code': course.code}) }}" style="text-decoration:none; color:black;">{{ course.title }}</a>
							</h5>
							<p>{{ course.description }}</p>

							{% set transaction = transactions[course.code] ?? null %}

							{% if transaction %}
								{% if transaction.type == 'payment' %}
									<p>Куплено</p>
									<a href="{{ path('app_course_show', {'code': course.code}) }}" class="btn btn-primary">Проходить курс</a>
								{% elseif transaction.type == 'rent' %}
									{% if transaction.expires_at is defined %}
										<p>Арендовано до:
											{{ transaction.expires_at|date('d-m-Y') }}</p>
									{% else %}
										<p>Арендовано, срок аренды неизвестен</p>
									{% endif %}
									<a href="{{ path('app_course_show', {'code': course.code}) }}" class="btn btn-primary">Проходить курс</a>
								{% endif %}
							{% else %}
								{% if course.type == 1 %}
									<p>Цена покупки:
										{{ course.price }}
										руб.</p>
									<form action="{{ path('app_course_buy', {'code': course.code}) }}" method="post" class="purchase-form">
										<input type="hidden" name="token" value="{{ token }}">
										<button type="submit" class="btn btn-success">Купить курс</button>
									</form>
								{% elseif course.type == 2 %}
									<p>Цена аренды:
										{{ course.price }}
										руб.</p>
									<form action="{{ path('app_course_rent', {'code': course.code}) }}" method="post" class="rent-form">
										<input type="hidden" name="token" value="{{ token }}">
										<button type="submit" class="btn btn-info">Арендовать</button>
									</form>
								{% else %}
									<a href="{{ path('app_course_show', {'code': course.code}) }}" class="btn btn-primary">Бесплатный доступ</a>
								{% endif %}
							{% endif %}
						</div>
					</div>
				</div>
			{% endfor %}
		</div>

		<hr>

		<div class="d-flex justify-content-center">
			<a href="{{ path('app_course_new') }}">
				<button type="button" class="btn btn-outline-secondary">Новый курс</button>
			</a>
		</div>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
const purchaseForms = document.querySelectorAll('.purchase-form');
const rentForms = document.querySelectorAll('.rent-form');

purchaseForms.forEach(function (form) {
form.addEventListener('submit', function (event) {
if (!confirm('Вы уверены, что хотите купить этот курс?')) {
event.preventDefault();
}
});
});

rentForms.forEach(function (form) {
form.addEventListener('submit', function (event) {
if (!confirm('Вы уверены, что хотите арендовать этот курс?')) {
event.preventDefault();
}
});
});
});
	</script>

{% endblock %}
